<!doctype html>

<html>

<head>
  <title>Test Fretboard Page</title>
  <meta name="viewport" content="initial-scale=1">
  <script src="../jquery-1.11.2.min.js"></script>
  <script src="../fretboard.js"></script>
  <script src="angular.js"></script>
  <script src="safeApply.js"></script>
  <script src="angular-fretboard.js"></script>
  <link rel="stylesheet" type="text/css" href="../styles.css">
</head>

<body ng-app="myApp">
    <style>
        .container {
            min-width: 280px;
            max-width: 1600px;
            min-height: 600px;
            overflow-x: hidden;
            background: lightgray;
            padding: 20px 40px;
        }
        
        button {
            margin: 10px 2.5%;
            cursor: pointer;
            height: 80px;
            width: 20%;
            float: left;
            padding: 10px;
            font-size: 12px;
            overflow: auto;
        }

        .disclaimer {
            text-align: center;
        }

        .disclaimer-first {
            margin-top: 30px;
        }

        .fretboard-container .note.clicked.green {
            background: green;
        }

        .fretboard-container .note.clicked.red {
            background: red;
        }

        .fretboard-container .note.clicked.yellow {
            background: yellow;
        }

        .fretboard-container .note.clicked.orange {
            background: orange;
        }

        .json {
            width:100%;
            clear:both;
            padding-top: 10px;
        }

        .json p {
            text-align: center;
        }

        @media (max-width: 800px) {
            .container {
                padding: 5px;
            }
        }

        @media (max-width: 767px) {
            button {
                width: 95%;
                height: 50px;
                overflow: hidden;
                margin: 2px 2.5%;
                padding: 2px;
            }
        }
    </style>
<div class="container" ng-controller="MyController">
    <script type="text/javascript">
        var app = angular.module("myApp", ['angularFretboard']);

        app.controller("MyController", ["$scope",
            function ($scope) {
                var isChordMode = true;
                var isDisabled = false;
                var eightStringTuning = [{
                    letter: "E",
                    octave: 4
                }, {
                    letter: "B",
                    octave: 3
                }, {
                    letter: "G",
                    octave: 3
                }, {
                    letter: "D",
                    octave: 3
                }, {
                    letter: "A",
                    octave: 2
                }, {
                    letter: "E",
                    octave: 2
                }, {
                    letter: "B",
                    octave: 1
                }, {
                    letter: "F#/Gb",
                    octave: 1
                }];
                var standardTuning = $.extend(true, [], eightStringTuning).slice(0, 6);
                var numFrets = 16;
                var cMaj7Notes = [{
                    stringItsOn: {
                        letter: "E",
                        octave: 4
                    },
                    fretNumber: 3,
                    cssClass: "red"
                }, {
                    stringItsOn: {
                        letter: "B",
                        octave: 3
                    },
                    fretNumber: 5,
                    cssClass: "red"
                }, {
                    stringItsOn: {
                        letter: "G",
                        octave: 3
                    },
                    fretNumber: 4,
                    cssClass: "red"
                }, {
                    stringItsOn: {
                        letter: "D",
                        octave: 3
                    },
                    fretNumber: 5,
                    cssClass: "red"
                }, {
                    stringItsOn: {
                        letter: "A",
                        octave: 2
                    },
                    fretNumber: 3,
                    cssClass: "red"
                }];
                var aMin7Notes = [{
                    stringItsOn: {
                        letter: "B",
                        octave: 3
                    },
                    fretNumber: 5,
                    cssClass: "green"
                }, {
                    stringItsOn: {
                        letter: "G",
                        octave: 3
                    },
                    fretNumber: 5,
                    cssClass: "green"
                }, {
                    stringItsOn: {
                        letter: "D",
                        octave: 3
                    },
                    fretNumber: 5,
                    cssClass: "green"
                }, {
                    stringItsOn: {
                        letter: "E",
                        octave: 2
                    },
                    fretNumber: 5,
                    cssClass: "green"
                }];
                var fMaj7Notes = [{
                    stringItsOn: {
                        letter: "B",
                        octave: 3
                    },
                    fretNumber: 1,
                    cssClass: "yellow"
                }, {
                    stringItsOn: {
                        letter: "G",
                        octave: 3
                    },
                    fretNumber: 2,
                    cssClass: "yellow"
                }, {
                    stringItsOn: {
                        letter: "D",
                        octave: 3
                    },
                    fretNumber: 2,
                    cssClass: "yellow"
                }, {
                    stringItsOn: {
                        letter: "E",
                        octave: 2
                    },
                    fretNumber: 1,
                    cssClass: "yellow"
                }];
                var g7Notes = [{
                    stringItsOn: {
                        letter: "B",
                        octave: 3
                    },
                    fretNumber: 3
                }, {
                    stringItsOn: {
                        letter: "G",
                        octave: 3
                    },
                    fretNumber: 4
                }, {
                    stringItsOn: {
                        letter: "D",
                        octave: 3
                    },
                    fretNumber: 3
                }, {
                    stringItsOn: {
                        letter: "E",
                        octave: 2
                    },
                    fretNumber: 3
                }];
                var dimensionsFunc = function ($fretboardContainer, $fretboardBody, settings) {
                    var numStrings = settings.tuning.length;

                    return {
                        height: numStrings * 32
                    };
                };
                var noteCircleList = [3, 5, 7, 9, 12, 15, 17, 19, 21, 24];
                var intervalSettings = {
                    intervals: ['1', 'b2', '2', 'b3', '3', '4', 'b5', '5', 'b6', '6', 'b7', '7'],
                    root: "C"
                };
                var noteMode = 'letter'; // or 'interval',
                var isIntervalMode = noteMode === 'interval';
                var clickedNotesChangedFuncs = [function () {
                    console.log("On clicked notes change 1. Clicked notes are: ");
                    console.log($scope.config.clickedNotes);
                }, function () {
                    console.log("On clicked notes change 2");
                }];
                var options = {
                    tuning: standardTuning,
                    numFrets: numFrets,
                    isChordMode: isChordMode,
                    noteClickingDisabled: isDisabled,
                    allNoteLetters: ["C", "C#/Db", "D", "D#/Eb", "E", "F", "F#/Gb", "G", "Ab/G#", "A", "A#/Bb", "B"],
                    noteMode: noteMode,
                    intervalSettings: intervalSettings,
                    animationSpeed: 400, // ms
                    noteCircleList: noteCircleList,
                    dimensionsFunc: dimensionsFunc,
                    onClickedNotesChange: clickedNotesChangedFuncs
                };

                $scope.config = options;

                // For testing - outputs the config during changes to tuning, clicked notes, etc.
                /*$scope.$watch(function () {
                    return $scope.config
                }, function (newVal, oldval) {
                    console.log($scope.config);
                }, true);*/

                $scope.toggleChordMode = function () {
                    $scope.config.isChordMode = !$scope.config.isChordMode;
                };

                $scope.setMaj7Chord = function () {
                    $scope.config.clickedNotes = $.extend(true, [], cMaj7Notes);
                };

                $scope.setMin7Chord = function () {
                    $scope.config.clickedNotes = $.extend(true, [], aMin7Notes);
                };

                $scope.getClickedNotes = function () {
                    console.log($scope.config.clickedNotes);
                };

                $scope.toggleNoteClicking = function () {
                    $scope.config.noteClickingDisabled = !$scope.config.noteClickingDisabled;
                };

                $scope.addString = function () {
                    // make a copy to change the reference 
                    if ($scope.config.tuning.length < eightStringTuning.length) {
                        $scope.config.tuning = $.extend(true, [], $scope.config.tuning);
                        $scope.config.tuning.push({
                            letter: eightStringTuning[$scope.config.tuning.length].letter,
                            octave: eightStringTuning[$scope.config.tuning.length].octave
                        });
                    }
                };

                $scope.removeString = function () {
                    // make a copy to change the reference 
                    if ($scope.config.tuning.length > 4) {
                        $scope.config.tuning = $.extend(true, [], $scope.config.tuning);
                        $scope.config.tuning.pop();
                    }
                };

                $scope.changeToStandardTuning = function () {
                    // make a copy to change the reference 
                    $scope.config.tuning = $.extend(true, [], standardTuning);
                };

                $scope.changeToEightStringTuning = function () {
                    // make a copy to change the reference 
                    $scope.config.tuning = $.extend(true, [], eightStringTuning);
                };

                $scope.addFret = function () {
                    if ($scope.config.numFrets < 24) {
                        $scope.config.numFrets++;
                    }
                };

                $scope.removeFret = function () {
                    if ($scope.config.numFrets > 12) {
                        $scope.config.numFrets--;
                    }
                };

                $scope.unclick = function () {
                    $scope.config.clickedNotes = [];
                };

                $scope.toggleNoteMode = function () {
                    isIntervalMode = !isIntervalMode;
                    $scope.config.noteMode = isIntervalMode ? 'interval' : 'letter';
                };

                $scope.toggleIntervalSettings = function () {
                    intervalSettings = $.extend(true, {}, intervalSettings);
                    intervalSettings.root = intervalSettings.root === "C" ? "G" : "C";
                    $scope.config.intervalSettings = intervalSettings;
                };
            }
        ]);
    </script>

    <div fretboard fretboard-config='config'></div>

    <p class="disclaimer disclaimer-first">
        Note that some of these operations may throw errors. This is intentional so you can view the errors in the console.
    </p>

    <p class="disclaimer">
        For example, click the "Remove string" button and then "Click A min7 chord" button.
    </p>

    <button ng-click="setMaj7Chord()">Set C maj7 chord</button>
    <button ng-click="setMin7Chord()">Set A min7 chord</button>
    <!-- show-progression placeholder -->
    <!-- show-scale-run placeholder -->
    <!-- show-arpeggio placeholder -->
    <button ng-click="getClickedNotes()">Get clicked notes (console)</button>
    <button ng-click="unclick()">Unclick Notes</button>
    <button ng-click="toggleNoteClicking()">Disable/enable note clicking</button>
    <button ng-click="addString()">Add String</button>
    <button ng-click="removeString()">Remove String</button>
    <button ng-click="changeToEightStringTuning()">Change to 8-string tuning</button>
    <button ng-click="changeToStandardTuning()">Change to standard tuning</button>
    <button ng-click="addFret()">Add fret</button>
    <button ng-click="removeFret()">Remove fret</button>
    <button ng-click="toggleChordMode()">Toggle chord mode</button>
    <button ng-click="toggleNoteMode()">Toggle note mode (interval/letter)</button>
    <button ng-click="toggleIntervalSettings()">Change root for interval mode (C/G)</button>


    <div class="json">
        <p>Config data-binding</p>
        <pre>{{ config | json }}</pre>
    </div>
</div>
</body>

</html>
